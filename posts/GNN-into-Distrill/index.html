<!DOCTYPE html><html lang="zh" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="GNN" /><meta name="author" content="Harry-hhj" /><meta property="og:locale" content="zh" /><meta name="description" content="GNN" /><meta property="og:description" content="GNN" /><link rel="canonical" href="https://harry-hhj.github.io/posts/GNN-into-Distrill/" /><meta property="og:url" content="https://harry-hhj.github.io/posts/GNN-into-Distrill/" /><meta property="og:site_name" content="Harry’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-29T10:20:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="GNN" /><meta name="twitter:site" content="@None" /><meta name="twitter:creator" content="@Harry-hhj" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Harry-hhj"},"dateModified":"2022-06-29T11:17:40+08:00","datePublished":"2022-03-29T10:20:00+08:00","description":"GNN","headline":"GNN","mainEntityOfPage":{"@type":"WebPage","@id":"https://harry-hhj.github.io/posts/GNN-into-Distrill/"},"url":"https://harry-hhj.github.io/posts/GNN-into-Distrill/"}</script><title>GNN | Harry's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Harry's Blog"><meta name="application-name" content="Harry's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?f40851b91841f1abe810a63f8d41c2e2"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Harry's Blog</a></div><div class="site-subtitle font-italic">Write blogs, share ideas, make friends and enjoy life.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Harry-hhj" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['Harry_hhj','163.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>GNN</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>GNN</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Harry-hhj </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 29, 2022, 10:20 AM +0800" >Mar 29<i class="unloaded">2022-03-29T10:20:00+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 29, 2022, 11:17 AM +0800" >Jun 29<i class="unloaded">2022-06-29T11:17:40+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4232 words">23 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 320'%3E%3C/svg%3E" data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/cover.png" class="preview-img" alt="Preview Image" width="640" height="320"><h1 id="gnn">GNN</h1><blockquote><p>https://distill.pub/2021/gnn-intro/</p></blockquote><h2 id="一什么是图">一、什么是图</h2><p>图 (graph) 是表示实体 (entities) 间的一些关系。实体就是顶点 (nodes) ，关系就是边 (edges) 。</p><p>现在定义如下标记：顶点 V 、边 E 、全局 U ，这些标记所蕴含的信息就叫 attribute 。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325112206754.png" alt="image-20220325112206754" style="zoom:50%;" /></p><p>图一般分为两类：有向图和无向图。例如，微信上两个人互为朋友，这种关系是没有方向的，但在 B 站上你关注了主播，主播却没有关注你，这种关系就是有方向的。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325112610688.png" alt="image-20220325112610688" style="zoom:50%;" /></p><p>那么数据是如何表示成图的？</p><ul><li><p>图片</p><p>首先观察我们熟悉的图像。假定有一张 $244\times244\times3$ 的图像，将其看成一个图（非图像），那么每个像素就是一个顶点，像素间的邻接关系就是边。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325114104486.png" alt="image-20220325114104486" style="zoom:50%;" /></p><p>中间的矩阵叫做邻接矩阵 $\mathbf A$ (adjacency matrix) ，它的行和列都是顶点。 \(\begin{cases} a_{ij} = 1 &amp; if ~ v_i\text{ is connected with } v_j\\ a_{ij} = 0 &amp; otherwise \end{cases}\) 邻接矩阵通常是很大且稀疏的矩阵。</p><li><p>文本</p><p>文本可以看作是一个序列，可以将其中的每一个词作为顶点，一个词和下一个词时间有一个有向边。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325114623963.png" alt="image-20220325114623963" style="zoom:50%;" /></p><li><p>分子图</p><p>每一个原子表示成图里的一个点，原子间的化学键表示成一条边。例如咖啡因：</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325155408826.png" alt="image-20220325155408826" style="zoom:50%;" /></p><li><p>社交网络</p><p>以下是《奥塞德》所有任务的交互图。任何人物如果同时出现在一个场景中，就会在他们之间连一条边。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325160306565.png" alt="image-20220325160306565" style="zoom:50%;" /></p><li><p>引用图</p><p>文章之间的引用关系被表示为有向边。</p></ul><p>实际中我们碰到的图的平均大小如下：</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325160527491.png" alt="image-20220325160527491" style="zoom:50%;" /></p><p>在我们把数据表示为图之后，我们看看可以在这些图上定义那些问题。主要有三大类问题：图级别 (graph-level) 的、顶点级别 (node-level) 的和边级别 (edge-level) 的。</p><ul><li><p>图级别的任务：判断整个图的性质。</p><p>比如下图中哪个图含有两个环。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325161000563.png" alt="image-20220325161000563" style="zoom:50%;" /></p><li><p>顶点级别的任务：判断节点在图中的角色。</p><p>比如通过两个跆拳道老师和学生打过比赛的图，判断某个学生属于哪个老师管辖。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325161354733.png" alt="image-20220325161354733" style="zoom:50%;" /></p><li><p>边级别的任务</p><p>比如对于一张图片，先进行语义分割，将人物和背景提取出后，判断任务之间是什么关系，即学习顶点之间边的属性。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325161646052.png" alt="image-20220325161646052" style="zoom:50%;" /></p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325161714275.png" alt="image-20220325161714275" style="zoom:50%;" /></p></ul><p>那么将图用到机器学习上有哪些挑战呢？神经网络使用图的一个最核心的问题是如何表示图，使得它与神经网络是兼容的。一个图上有四种信息：</p><ul><li>顶点的属性<li>边的属性<li>全局信息<li>连接性</ul><p>前面三个都可以用一个向量来表示，但表示连接性更为复杂。使用邻接矩阵虽然可以达到效果，但是它会非常大，而其中存在的边却不多。或许我们可以使用稀疏矩阵解决存放的问题，但是稀疏矩阵的高效运算尤其是如何在 GPU 上高效运算是一个很难的问题。另一个问题是对于邻接矩阵，交换任意的行和列都不会产生影响，因此神经网络需要能够处理这些看上去完全不同却代表同一张图的邻接矩阵。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325162657500.png" alt="image-20220325162657500" style="zoom:50%;" /></p><p>假设有四个顶点和四条边，以下是所有可能的邻接矩阵。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325162853661.png" alt="image-20220325162853661" style="zoom:50%;" /></p><p>如果我们既想高效存储，又想不受存储顺序的影响，可以采用顶点属性、边属性、全局属性都采用标量/向量来表示，边的关系采用邻接列表的形式，元素 $i$ 表示第 $i$ 条边 $e_i = (v_s, v_e)$ ，表示连接的两个节点。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325163131107.png" alt="image-20220325163131107" /></p><p>那么给定这种输入的形式，神经网络应该如何处理？</p><h2 id="二图神经网络-graph-neural-networks">二、图神经网络 (Graph Neural Networks)</h2><p>GNN 是一个对图上的所有属性（包括顶点、边和全局的上下文 (global-context) ）进行的可以优化的变换，这个变换能够保持图的对称信息，即改变节点的排序后，结果不变。接下来我们使用信息传递网络框架 (“message passing neural network” framework) 搭建 GNN 。GNN 的输入是图，输出也是图，它会变换节点、边、全局的属性嵌入 (embeddings) ，但不会改变图的连接性。</p><h3 id="1-最简单的-gnn">1. 最简单的 GNN</h3><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325164402314.png" alt="image-20220325164402314" style="zoom:50%;" /></p><p>对于顶点、边、全局向量，我们分别构造一个多层感知机 (MLP) ，其输入大小和输出大小一致。这三个 MLP 就组成了 GNN 的一个层。经过这一层，图的属性将被更新，但是图的结果不发生变化。由于 MLP 是每个向量独自作用的，它不会考虑顺序，因此顶点排序的改变不会改变结果。</p><p>接下来考虑最后一层的输出如何得到我们要的预测值。假设我们想对顶点做预测，这其实和一般的 NN 没有区别。比如之前提到的学生归属哪个老师的问题，我们在之后加入一个输出维度为 2 的全连接层，再加上一个 softmax ，就可以完成任务。这里所有顶点嵌入共享一个全连接层的参数。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325165317817.png" alt="image-20220325165317817" style="zoom:50%;" /></p><p>我们将问题稍微复杂化一些。假设我们还是想要分类顶点，但是每个顶点没有嵌入向量。此时我们会用到一个技术 —— 汇聚 (pooling) 。我们会利用与它有关的边和全局信息来生成它的嵌入向量，这里假设所有属性向量的长度相同，如果不同我们还需要先进行投影变换。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325165843837.png" alt="image-20220325165843837" style="zoom:50%;" /></p><p>然后我们就可以用新得到的向量预测。以下分别是没有顶点属性和没有边属性进行预测的例子。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325170707800.png" alt="image-20220325170707800" style="zoom:50%;" /></p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220325170750305.png" alt="image-20220325170750305" style="zoom:50%;" /></p><p>因此，不管缺少哪一类属性，都可以通过汇聚操作的到想要的属性值。</p><p>于是，我们得到了一个最简单的 GNN 模型。给定一个输入的图，首先进入一系列的 GNN 层，每个层里有 3 个 MLP ，对应不同的属性，输出会得到结构不变、属性已经发生变化的一个图。然后根据需要对哪一个属性做预测，添加对应的输出层完成预测，其中如果缺失信息就加入合适的汇聚层。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326113534840.png" alt="image-20220326113534840" style="zoom:50%;" /></p><p>这个模型会有很大的局限性，主要在于 MLP 的位置没有使用图结构信息，每个顶点进入 MLP 时仅考虑自身信息。</p><p>接下来我们考虑如何改进，放入图的信息，要用到的技术是之前提到过的信息传递。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326135539990.png" alt="image-20220326135539990" style="zoom:50%;" /></p><p>我们将某个顶点的向量和邻居节点的向量相加，得到汇聚的向量，然后对这个向量进行更新 $f$ 。这一步骤类似于卷积操作，唯一不同的是所有邻居顶点的权重都为 $1$ 。当这种层叠加时，顶点的感受野增大，融合的不仅是邻居的特征。我们规定符号 $\rho_{_{V_n \to V_n}}$ 表示顶点和 1 近邻的信息传递过程。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326141251502.png" alt="image-20220326141251502" style="zoom:50%;" /></p><p>当某种属性缺失时，我们之前在最后从别的属性汇聚过来弥补这个属性。在中间层我们也可以通过信息传递完成更新。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326141518065.png" alt="image-20220326141518065" style="zoom:50%;" /></p><p>注意这种信息传递的先后顺序会导致结果的不同，目前没有研究证明优劣。</p><ul><li>先顶点后边学习<li>先边后顶点学习<li>交替更新 (Weave Layer) ：node to node (linear), edge to edge (linear), node to edge (edge layer), edge to node (node layer) 。</ul><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326144129489.png" alt="image-20220326144129489" style="zoom:50%;" /></p><p>上面我们讲述了顶点和边之间的信息交换，接下来我们看一下全局信息是怎么做的。首先为什么要有全局信息？在没有全局信息的情况下，顶点或边的视图只有邻居，当图很大且稀疏时，两个很远的点需要通过很多次更新才能交互。解决方法就是使用图的全局表示 $U$ ，也称为 master node 或 context vector 。这个虚拟的顶点与所有的顶点和边相连，这在图上想象会非常抽象。因为它与所有的顶点和边相连，因此在做顶点或边信息传递时，这个顶点的信息也是会考虑的。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326145111832.png" alt="image-20220326145111832" style="zoom:50%;" /></p><p>此时，所有的三类属性都学到了对应的向量，并进行过了消息传递。因此我们可以在池化期间通过调节我们感兴趣的属性相对于其余属性的信息来利用它们。一种可能的方式是将向量 concat 起来，另一种可能的方式是通过线性映射将不同属性向量映射到相同的空间或应用特征调制层 (feature-wise modulation layer) 。</p><h2 id="三实验">三、实验</h2><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326150948422.png" alt="image-20220326150948422" style="zoom:50%;" /></p><p>这一部分需要在浏览器上自行实验，我们看一下作者关于模型超参数选择的解释。</p><p>先来看看模型大小（参数数量）和表现（AUC）之间的关系。当模型参数变多时， AUC 的上限是增加的，但是如果模型超参数设置得不好，参数增多也不会有更好的效果。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326152215414.png" alt="image-20220326152215414" style="zoom:50%;" /></p><p>固定某种向量的长度，变换其他的参数，观察模型的表现。这里使用了箱线图 (box plot) ，其中横线表示中值， bar 是 25% - 75% 的数据，最高/低的点是最大/小值。我们会希望中值越高越好， bar 也不要太长（太敏感）。从图中看来，维度越大，效果稍微好一点，但不是很明显。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326153125723.png" alt="image-20220326153125723" style="zoom:50%;" /></p><p>接下来观察不同的层数对精度的影响。 $x$ 轴是学习参数的个数， $y$ 轴是测试精度。可以看出，层数越少，学习参数越少，从左图看不出精度的差别。但在箱线图中，随着层数的增加，精度也在增加。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326153557786.png" alt="image-20220326153557786" style="zoom:50%;" /></p><p>接下来观察不同聚合操作的影响。三者几乎没有什么区别。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326154122691.png" alt="image-20220326154122691" style="zoom:50%;" /></p><p>最后观察需要在哪些属性上传递信息。绿色表示不聚合任何信息，也就是我们之前讨论的最简单的 GNN ，效果是最差的。随着不断加入各种信息传递，模型效果越来越好。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326154229031.png" alt="image-20220326154229031" style="zoom:50%;" /></p><p>可以看出 GNN 对超参数还是比较敏感的，可以调节的参数有：层数、嵌入向量大小、汇聚操作类型、如何进行信息传递。</p><h2 id="四gnn-相关">四、GNN 相关</h2><h3 id="1-其他类型的图">1. 其他类型的图</h3><ul><li><p>mutigraphs</p><p>定点之间有多种类型的边</p><li><p>hierarchical graphs</p><p>图是分层的，一些顶点是一个子图。不同的图结构在神经网络如何进行信息汇聚产生一定的影响。</p></ul><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326155654540.png" alt="image-20220326155654540" style="zoom:50%;" /></p><h3 id="2-如何对图进行采样-sampling-和-batching">2. 如何对图进行采样 (Sampling) 和 Batching</h3><p>之前我们讲过，假设有很多层 GNN ，最后一层的顶点可以看到很广的范围，在连通性足够的情况下，可能会看到整个图的信息。在计算梯度时，我们需要把所有的中间变量存储下来，这可能导致最后的计算代价时无法承受的。因此，我们需要对图进行采样，即我们把图拆封成子图，在子图上进行信息汇聚。有几种采样的方法：</p><ul><li>Random node sampling ：随机采样一些点，找出这些点的邻居，在这些子图上进行计算。通过控制每次采样多少个点，避免图过大，能够存入内存。<li>Random walk sampling ：从某一个顶点，随机找到它的一条边，找到下一个顶点，通过规定最多随机走多少步，获得一个子图。<li>Random walk with nerghborhood ：随机游走后找出所有顶点的邻居。<li>Diffusion Sampling ：选择一个节点，找出它的 k 阶邻，即进行宽度遍历，取出子图。</ul><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326160641089.png" alt="image-20220326160641089" style="zoom:50%;" /></p><p>具体哪种方法有效还是取决于数据集。</p><p>跟采样相关的问题是进行 batching 。我们不希望对每一个顶点逐步更新，其计算量太小，不利于并行。但是每个顶点的邻居数量是不一样的，如何合并成一个规整的张量是一个有挑战性的问题。</p><h3 id="3-inductive-biases">3. Inductive biases</h3><p>任何神经网络都基于一些假设。比如，CNN 假设空间平移不变性， RNN 假设时间平移不变性。 GNN 的假设是保持了图的对称性。</p><h3 id="4-不同的汇聚操作">4. 不同的汇聚操作</h3><p>其实 <code class="language-plaintext highlighter-rouge">sum</code> 、 <code class="language-plaintext highlighter-rouge">mean</code> 、 <code class="language-plaintext highlighter-rouge">max</code> 没有一种是非常理想的。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326161847191.png" alt="image-20220326161847191" style="zoom:50%;" /></p><h3 id="5-gcn-作为子图的函数近似">5. GCN 作为子图的函数近似</h3><p>GCN 如果有 k 个层，每个层看 1 阶邻，最后每一个顶点看到的是一个 k-step 的子图，即这个顶点的表示就是这个子图的 embedding 。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326162249214.png" alt="image-20220326162249214" style="zoom:50%;" /></p><h3 id="6-可以将点和边对偶-dual">6. 可以将点和边对偶 (Dual)</h3><p>根据图论，讲一个图的点变成边、边变成点，图的邻接关系不变。</p><h3 id="7-图卷积作为矩阵乘法矩阵乘法作为图上的游走">7. 图卷积作为矩阵乘法、矩阵乘法作为图上的游走</h3><p>在图上进行卷积或者随机游走等价于在邻接矩阵上进行矩阵乘法。图卷积作为矩阵乘法也是如何高效实现 GCN 的关键。</p><h3 id="8-图注意力网络-graph-attention-networks">8. 图注意力网络 (Graph Attention Networks)</h3><p>卷积对每个邻居有个权重，但卷积的权重是和位置相关的，但这对于图是无用的，因为图的邻居个数和顺序不固定。一种做法是用注意力机制的方法，权重取决于两个顶点向量之间的关系。具体看 Transformer 中的原理。</p><p><img data-proofer-ignore data-src="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io/master/_posts/2022-03-29-GNN-into-Distrill.assets/image-20220326163120622.png" alt="image-20220326163120622" style="zoom:50%;" /></p><h3 id="9-图的可解释性">9. 图的可解释性</h3><h3 id="10-生成图">10. 生成图</h3><p>如何对图的拓扑结构进行有效的建模</p><h2 id="五结论">五、结论</h2><p>图表是一种强大而丰富的结构化数据类型，其优势和挑战与图像和文本截然不同。 在本文中，我们概述了研究人员在构建基于神经网络的图形处理模型方面提出的一些里程碑。 我们已经介绍了使用这些架构时必须做出的一些重要设计选择，希望 GNN 游乐场可以直观地了解这些设计选择的经验结果是什么。 近年来 GNN 的成功为解决各种新问题创造了绝佳机会，我们很高兴看到该领域将带来什么。</p><h2 id="六回顾">六、回顾</h2><p>作者先介绍了什么是图，用向量表示图的属性（顶点、边、全局），然后介绍了现实生活中的数据如何表示成图，如何对图做预测，以及机器学习算法用到图上的时候有什么挑战。接下来作者开始介绍 GNN 。 GNN 就是对属性做变化，而不改变图的结构，并设计了一个简单的例子。当属性有缺失时，可以使用聚合 (pooling) 的操作。然后作者介绍了我们日常使用中真正意义上的 GNN ，通过每一层将信息不断传递，每个顶点可以看到邻接顶点、相连边、全局的信息。 GNN 能够对图的结构进行有效的发掘。然后就是一个实际的 GNN 模型实验。接下来他讨论了一些有关的拓展问题。尤其关注作者的精美的图。</p><p><br /></p><p><strong>如果觉得本教程不错或对您有用，请前往项目地址 <a href="https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io">https://raw.githubusercontent.com/Harry-hhj/Harry-hhj.github.io</a> 点击 Star :) ，这将是对我的肯定和鼓励，谢谢！</strong></p><p><br /></p><hr /><p>作者：Harry-hhj，Github主页：<a href="https://raw.githubusercontent.com/Harry-hhj">传送门</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorial/'>Tutorial</a>, <a href='/categories/gnn/'>GNN</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/gnn/" class="post-tag no-text-decoration" >gnn</a> <a href="/tags/graph/" class="post-tag no-text-decoration" >graph</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GNN - Harry's Blog&url=https://harry-hhj.github.io/posts/GNN-into-Distrill/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GNN - Harry's Blog&u=https://harry-hhj.github.io/posts/GNN-into-Distrill/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=GNN - Harry's Blog&url=https://harry-hhj.github.io/posts/GNN-into-Distrill/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/C++-primer-plus-v6/">C++ Primer Plus v6</a><li><a href="/posts/Understanding-LSTM-Networks/">Understanding LSTM Networks</a><li><a href="/posts/Transformers-are-Graph-Neural-Networks/">Transformers are Graph Neural Networks</a><li><a href="/posts/RM-Tutorial-6-Stereo/">RM 教程 6 —— 特征点，双目相机与光流</a><li><a href="/posts/Transformer/">Transformer</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/robomaster/">robomaster</a> <a class="post-tag" href="/tags/install/">install</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/computer-science/">computer science</a> <a class="post-tag" href="/tags/ml/">ml</a> <a class="post-tag" href="/tags/catalog/">catalog</a> <a class="post-tag" href="/tags/opencv/">opencv</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a> <a class="post-tag" href="/tags/computer-vision/">computer vision</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Transformers-are-Graph-Neural-Networks/"><div class="card-body"> <span class="timeago small" >Jun 28<i class="unloaded">2022-06-28T10:50:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Transformers are Graph Neural Networks</h3><div class="text-muted small"><p> Transformers are Graph Neural Networks https://thegradient.pub/transformers-are-graph-neural-networks/ Transformer 的出现推动了整个 NLP 领域。这篇博客旨在建立 GNNs 和 Transformers 之间的联系。 首先，两者都是为了完成“表征学习”（repre...</p></div></div></a></div><div class="card"> <a href="/posts/Mathematical-principles-behind-GCN/"><div class="card-body"> <span class="timeago small" >Apr 6<i class="unloaded">2022-04-06T20:12:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mathematical principles behind GCN</h3><div class="text-muted small"><p> GCN 背后的数学原理 一、定义 GNN 的更新公式为 \(H^{(l+1)} = f(A, H^{(l)})\) 即根据当前的隐藏状态，根据与其他节点的连接关系，进行某种映射，得到下一步隐藏状态。所有的 GNN 网络其实都是在设计 $f$ 。而 GCN 的 $f$ 定义如下 \(H^{(l+1)} = \sigma(\hat D^{-\frac12} \hat A \hat D^{-\...</p></div></div></a></div><div class="card"> <a href="/posts/Transformer/"><div class="card-body"> <span class="timeago small" >Mar 29<i class="unloaded">2022-03-29T10:10:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Transformer</h3><div class="text-muted small"><p> Transformer https://arxiv.org/abs/1706.03762 一、摘要 主流的序列转录模型主要依赖于复杂的循环或者卷积神经网络，其中包含编码器 (encoder) 和解码器 (decoder) 。在最好的模型中也会在编码器和解码器之间使用注意力机制。这篇文章提出一个新的简单的架构 —— Transformer ，这个模型仅仅依赖于注意力机制，而没有使...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Transformer/" class="btn btn-outline-primary" prompt="Older"><p>Transformer</p></a> <a href="/posts/Common-Metrics-in-Machine-Learning/" class="btn btn-outline-primary" prompt="Newer"><p>Common Metrics in Machine Learning</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/Harry-hhj">HHJ</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/robomaster/">robomaster</a> <a class="post-tag" href="/tags/install/">install</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/computer-science/">computer science</a> <a class="post-tag" href="/tags/ml/">ml</a> <a class="post-tag" href="/tags/catalog/">catalog</a> <a class="post-tag" href="/tags/opencv/">opencv</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a> <a class="post-tag" href="/tags/computer-vision/">computer vision</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
